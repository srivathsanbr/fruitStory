<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Fruit Story Â· Medigrade</title>
  <link rel="icon" href="./assets/logo.png"/>
  <link rel="manifest" href="./site.webmanifest"/>
  <link rel="stylesheet" href="./styles.css"/>
</head>
<body>
<div class="bgWrap" aria-hidden="true">
  <div class="bgMesh"></div><div class="blob b1"></div><div class="blob b2"></div><div class="bgGrain"></div>
</div>
<div class="announce"><div class="bar"><div class="container"><div id="announceBar"></div></div></div></div>
<header class="header">
  <div class="container">
    <div class="row">
      <a class="brand" href="./index.html">
        <img src="./assets/logo.png" alt="Fruit Story logo"/>
        <div><div class="name">Fruit Story</div><div class="sub">Swara Ascent IMPEX</div></div>
      </a>
      <nav class="navlinks">
        <a href="./index.html" class="">Home</a>
        <a href="./products.html" class="active">Catalog</a>
        <a href="./medigrade.html" class="">Medigrade</a>
        <a href="./about.html" class="">About</a>
        <a href="./contact.html" class="">Contact</a>
      </nav>
      <div class="iconbar">
        <button class="iconbtn" id="btnSearch" aria-label="Search">ðŸ”Ž</button>
        <a class="iconbtn" href="https://instagram.com/Fruitstory.co" target="_blank" rel="noreferrer" aria-label="Instagram">ðŸ“·</a>
        <button class="iconbtn" id="btnWishlist" aria-label="Wishlist">â™¡<span class="badge" id="wishCount">0</span></button>
        <button class="iconbtn" id="btnCart" aria-label="Cart">ðŸ›’<span class="badge" id="cartCount">0</span></button>
      </div>
    </div>
  </div>
</header>

<div class="overlay" id="overlay"></div>

<aside class="drawer" id="searchDrawer">
  <div class="drawerHeader"><b>Search</b><button class="iconbtn" id="closeSearch">âœ•</button></div>
  <div class="drawerBody">
    <input id="searchInput" style="width:100%; padding:12px 12px; border-radius:16px; border:1px solid var(--line)" placeholder="Search fruits (name, origin, grade)..." />
    <div style="height:12px"></div>
    <div id="searchResults" class="grid cols-3"></div>
  </div>
</aside>

<aside class="drawer" id="cartDrawer">
  <div class="drawerHeader"><b>Shopping Cart</b><button class="iconbtn" id="closeCart">âœ•</button></div>
  <div class="drawerBody">
    <div id="cartItems"></div>
    <div class="small" id="cartEmpty" style="display:none">Your cart is currently empty.</div>
    <div style="height:12px"></div>
    <label class="small">Note for seller</label>
    <textarea id="cartNote" style="width:100%; min-height:90px; padding:12px; border-radius:16px; border:1px solid var(--line)"></textarea>
  </div>
  <div class="drawerFooter">
    <div style="display:flex; justify-content:space-between; align-items:center; gap:10px">
      <div class="small">Subtotal</div><div><b id="cartSubtotal">â‚¹ 0</b></div>
    </div>
    <div class="btnrow">
      <button class="btn dark magnetic" id="btnCheckout" style="flex:1">Checkout on WhatsApp</button>
      <a class="btn magnetic" href="tel:+919790976381" style="flex:1; text-align:center">Call</a>
    </div>
  </div>
</aside>

<main class="container">
  <section class="section reveal">
    <h1 style="margin:0 0 8px; letter-spacing:-.02em">Catalog</h1>
    <div class="small">Filter by grade and checkout via WhatsApp.</div>
    <div class="tile reveal" style="margin-top:14px"><div class="pad" style="display:flex; gap:10px; flex-wrap:wrap; align-items:center">
      <button class="btn primary magnetic" data-filter="all">All</button>
      <button class="btn magnetic" data-filter="medigrade">MEDIGRADEâ„¢</button>
      <button class="btn magnetic" data-filter="premium">Premium</button>
      <button class="btn magnetic" data-filter="clean">Clean</button>
      <button class="btn magnetic" data-filter="berries">Berries</button>
      <button class="btn magnetic" data-filter="imports">Imports</button>
      <div style="flex:1"></div>
      <button class="btn brand magnetic" id="openSearchInline">Search</button>
    </div></div>
    <div style="height:14px"></div>
    <div class="grid cols-4 stagger" id="productsGrid"></div>
  </section>
</main>
<script>
document.addEventListener("DOMContentLoaded", ()=>{
  const grid = document.getElementById("productsGrid");
  document.getElementById("openSearchInline")?.addEventListener("click", ()=>document.getElementById("btnSearch")?.click());

  function applyFilter(key){
    const all = (window.state && window.state.catalog) ? window.state.catalog : [];
    let items = all;
    if(key && key !== "all"){
      items = all.filter(x => String(x.grade||"").toLowerCase()===key || String(x.type||"").toLowerCase()===key);
    }
    grid.innerHTML = items.map(window.productCard).join("");
    grid.querySelectorAll("button[data-add]").forEach((b)=>b.addEventListener("click", ()=>window.addToCart(b.dataset.add)));
    grid.querySelectorAll("button[data-buy]").forEach((b)=>b.addEventListener("click", ()=>{
      const item = window.state.catalog.find(x=>x.id===b.dataset.buy);
      const msg = `Hi Fruit Story, I want to order:\n${item.name}\nGrade: ${window.gradeLabel(item.grade)}\nPlease confirm availability & price.`;
      window.open(window.waLink(msg), "_blank");
    }));
    grid.querySelectorAll("button[data-wish]").forEach((b)=>b.addEventListener("click", ()=>window.toggleWish(b.dataset.wish)));
  }
  document.querySelectorAll("button[data-filter]").forEach(btn=>btn.addEventListener("click", ()=>applyFilter(btn.dataset.filter)));
  const wait = setInterval(()=>{ if(window.state?.catalog?.length){ clearInterval(wait); applyFilter("all"); } }, 120);
});
</script>

<footer class="footer">
  <div class="container">
    <div class="small">Â© Fruit Story Â· Swara Ascent IMPEX Â· Instagram: <a href="https://instagram.com/Fruitstory.co" target="_blank" rel="noreferrer">@Fruitstory.co</a></div>
  </div>
</footer>
<a class="fab" href="./w/" aria-label="WhatsApp"><span class="bub"></span> WhatsApp Order</a>
<script src="./js/app.js"></script>
</body></html>
